<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PostCSS Worker ÊµãËØï - ‰∏ªÁ∫øÁ®ãÈÖçÁΩÆÔºåWorker ÊâßË°å</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f3f4f6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 24px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2rem;
        }

        .header p {
            margin: 8px 0 0 0;
            opacity: 0.9;
        }

        .content {
            padding: 24px;
        }

        .status-bar {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ef4444;
        }

        .status-dot.ready {
            background: #10b981;
        }

        .status-dot.processing {
            background: #f59e0b;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .test-section {
            margin-bottom: 24px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
        }

        .test-section h3 {
            margin: 0 0 16px 0;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .input-group textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            resize: vertical;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #2563eb;
        }

        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #4b5563;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #059669;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover:not(:disabled) {
            background: #d97706;
        }

        .status {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-weight: 500;
            display: none;
        }

        .status.show {
            display: block;
        }

        .status.processing {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .status.warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fcd34d;
        }

        .result-section {
            background: #1f2937;
            color: #f9fafb;
            padding: 16px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .quick-tests {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .quick-test {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 16px;
            text-align: center;
        }

        .quick-test h4 {
            margin: 0 0 12px 0;
            color: #374151;
            font-size: 1rem;
        }

        .quick-test-btn {
            background: #10b981;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .quick-test-btn:hover {
            background: #059669;
        }

        .config-info {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .config-info h4 {
            margin: 0 0 12px 0;
            color: #0369a1;
        }

        .config-details {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            background: #e0f2fe;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            border: none;
            background: none;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: #6b7280;
            font-weight: 500;
        }

        .tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üîß PostCSS Worker ÊµãËØï</h1>
            <p>‰∏ªÁ∫øÁ®ãÈÖçÁΩÆÔºåWorker ÊâßË°å - ÂÆåÂÖ®Âú® Web Worker ‰∏≠ËøêË°å PostCSS ËΩ¨Êç¢</p>
        </div>

        <div class="content">
            <!-- Áä∂ÊÄÅÊ†è -->
            <div class="status-bar">
                <div class="status-indicator">
                    <div id="statusDot" class="status-dot"></div>
                    <span id="statusText">ÂàùÂßãÂåñ‰∏≠...</span>
                </div>
                <div>
                    <button id="initBtn" class="btn btn-primary">ÂàùÂßãÂåñ PostCSS</button>
                    <button id="testBtn" class="btn btn-secondary">ËøêË°åÊµãËØï</button>
                    <button id="statusBtn" class="btn btn-warning">Ê£ÄÊü•Áä∂ÊÄÅ</button>
                </div>
            </div>

            <!-- ÈÖçÁΩÆ‰ø°ÊÅØ -->
            <div id="configInfo" class="config-info" style="display: none;">
                <h4>üìã PostCSS ÈÖçÁΩÆ‰ø°ÊÅØ</h4>
                <div id="configDetails" class="config-details"></div>
            </div>

            <!-- Ê†áÁ≠æÈ°µ -->
            <div class="tabs">
                <button class="tab active" data-tab="transform">CSS ËΩ¨Êç¢</button>
                <button class="tab" data-tab="test">ÊµãËØïÁî®‰æã</button>
                <button class="tab" data-tab="examples">Á§∫‰æã‰ª£Á†Å</button>
            </div>

            <!-- CSS ËΩ¨Êç¢Ê†áÁ≠æÈ°µ -->
            <div id="transform" class="tab-content active">
                <div class="test-section">
                    <h3>üé® CSS ËΩ¨Êç¢ÊµãËØï</h3>

                    <div class="input-group">
                        <label for="cssInput">ËæìÂÖ• CSS ‰ª£Á†ÅÔºö</label>
                        <textarea id="cssInput" placeholder="ËæìÂÖ•Ë¶ÅËΩ¨Êç¢ÁöÑ CSS ‰ª£Á†Å...">/* ÊµãËØï CSS */
.container {
  max-width: 1200px;
  margin: 0 auto;
}

.btn {
  @apply bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600;
}

.card {
  @apply bg-white rounded-lg shadow-md p-6 border border-gray-200;
}</textarea>
                    </div>

                    <div class="button-group">
                        <button id="transformBtn" class="btn btn-primary" disabled>ËΩ¨Êç¢ CSS</button>
                        <button id="clearBtn" class="btn btn-secondary">Ê∏ÖÁ©∫</button>
                    </div>

                    <div id="status" class="status"></div>

                    <div class="input-group">
                        <label for="resultOutput">ËΩ¨Êç¢ÁªìÊûúÔºö</label>
                        <div id="resultOutput" class="result-section" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- ÊµãËØïÁî®‰æãÊ†áÁ≠æÈ°µ -->
            <div id="test" class="tab-content">
                <div class="test-section">
                    <h3>üß™ PostCSS ÂäüËÉΩÊµãËØï</h3>
                    <p>ÊµãËØï PostCSS Âú® Worker ‰∏≠ÁöÑÂêÑÁßçÂäüËÉΩ</p>
                    
                    <div class="button-group">
                        <button id="runTestsBtn" class="btn btn-success">ËøêË°åÊâÄÊúâÊµãËØï</button>
                        <button id="clearTestsBtn" class="btn btn-secondary">Ê∏ÖÁ©∫ÁªìÊûú</button>
                    </div>

                    <div id="testStatus" class="status"></div>
                    <div id="testResults"></div>
                </div>
            </div>

            <!-- Á§∫‰æã‰ª£Á†ÅÊ†áÁ≠æÈ°µ -->
            <div id="examples" class="tab-content">
                <div class="test-section">
                    <h3>üìö Âø´ÈÄüÊµãËØïÁî®‰æã</h3>
                    <div class="quick-tests">
                        <div class="quick-test">
                            <h4>Tailwind ÁªÑ‰ª∂</h4>
                            <button class="quick-test-btn" onclick="loadExample('tailwind')">Âä†ËΩΩ</button>
                        </div>

                        <div class="quick-test">
                            <h4>CSS ÂèòÈáè</h4>
                            <button class="quick-test-btn" onclick="loadExample('variables')">Âä†ËΩΩ</button>
                        </div>

                        <div class="quick-test">
                            <h4>ÂµåÂ•ó CSS</h4>
                            <button class="quick-test-btn" onclick="loadExample('nested')">Âä†ËΩΩ</button>
                        </div>

                        <div class="quick-test">
                            <h4>Â™í‰ΩìÊü•ËØ¢</h4>
                            <button class="quick-test-btn" onclick="loadExample('media')">Âä†ËΩΩ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // PostCSS ÈÖçÁΩÆÁÆ°ÁêÜÁ±ª
        class PostCSSManager {
            constructor() {
                this.worker = null;
                this.config = null;
                this.processor = null;
                this.initialized = false;
                this.initWorker();
            }

            // ÂàùÂßãÂåñ Worker
            initWorker() {
                try {
                    this.worker = new Worker('./worker.js');
                    this.worker.onmessage = this.handleWorkerMessage.bind(this);
                    this.worker.onerror = this.handleWorkerError.bind(this);
                    console.log('Worker Â∑≤ÂàõÂª∫');
                } catch (error) {
                    console.error('Worker ÂàõÂª∫Â§±Ë¥•:', error);
                    this.showStatus('‚ùå Worker ÂàõÂª∫Â§±Ë¥•', 'error');
                }
            }

            // Â§ÑÁêÜ Worker Ê∂àÊÅØ
            handleWorkerMessage(e) {
                const { type, data, error } = e.data;
                
                switch (type) {
                    case 'init_success':
                        this.initialized = true;
                        this.updateStatus('‚úÖ PostCSS ÂàùÂßãÂåñÊàêÂäü', 'ready');
                        this.enableTransformButton();
                        this.showConfigInfo();
                        break;
                        
                    case 'init_error':
                        this.initialized = false;
                        this.updateStatus(`‚ùå ÂàùÂßãÂåñÂ§±Ë¥•: ${error}`, 'error');
                        break;
                        
                    case 'transform_success':
                        this.showTransformResult(data);
                        this.updateStatus('‚úÖ CSS ËΩ¨Êç¢ÊàêÂäü', 'ready');
                        break;
                        
                    case 'transform_error':
                        this.updateStatus(`‚ùå ËΩ¨Êç¢Â§±Ë¥•: ${error}`, 'error');
                        break;
                        
                    case 'test_success':
                        this.showTestResults(data);
                        this.updateStatus('‚úÖ ÊµãËØïÂÆåÊàê', 'ready');
                        break;
                        
                    case 'test_error':
                        this.updateStatus(`‚ùå ÊµãËØïÂ§±Ë¥•: ${error}`, 'error');
                        break;
                        
                    case 'status':
                        this.showWorkerStatus(data);
                        break;
                        
                    default:
                        console.log('Êú™Áü•Ê∂àÊÅØÁ±ªÂûã:', type, e.data);
                }
            }

            // Â§ÑÁêÜ Worker ÈîôËØØ
            handleWorkerError(error) {
                console.error('Worker ÈîôËØØ:', error);
                this.updateStatus(`‚ùå Worker ÈîôËØØ: ${error.message}`, 'error');
            }

            // ÂàùÂßãÂåñ PostCSS
            async initPostCSS() {
                try {
                    this.updateStatus('‚è≥ Ê≠£Âú®ÂàùÂßãÂåñ PostCSS...', 'processing');
                    
                    // ËØªÂèñ postcss.config.js ÈÖçÁΩÆÊñá‰ª∂
                    this.config = await this.loadPostCSSConfig();
                    
                    console.log('Â∑≤ËØªÂèñ PostCSS ÈÖçÁΩÆ:', this.config);

                    // ÂèëÈÄÅÈÖçÁΩÆÁªô WorkerÔºà‰∏çÂåÖÂê´Â§ÑÁêÜÂô®Ôºâ
                    this.worker.postMessage({
                        type: 'init',
                        data: {
                            config: this.config
                        }
                    });

                } catch (error) {
                    console.error('PostCSS ÂàùÂßãÂåñÂ§±Ë¥•:', error);
                    this.updateStatus(`‚ùå ÂàùÂßãÂåñÂ§±Ë¥•: ${error.message}`, 'error');
                }
            }

            // Âä†ËΩΩ PostCSS ÈÖçÁΩÆÊñá‰ª∂
            async loadPostCSSConfig() {
                try {
                    // Ëé∑Âèñ postcss.config.js Êñá‰ª∂ÂÜÖÂÆπ
                    const response = await fetch('./postcss.config.js');
                    if (!response.ok) {
                        throw new Error(`Êó†Ê≥ïÂä†ËΩΩÈÖçÁΩÆÊñá‰ª∂: ${response.status} ${response.statusText}`);
                    }
                    
                    const configText = await response.text();                    
                    // Ëß£ÊûêÈÖçÁΩÆÊñá‰ª∂
                    // Áî±‰∫éÈÖçÁΩÆÊñá‰ª∂ÊòØ ES module Ê†ºÂºèÔºåÊàë‰ª¨ÈúÄË¶ÅÁâπÊÆäÂ§ÑÁêÜ
                    const config = this.parsePostCSSConfig(configText);
                    
                    // Â¶ÇÊûúËß£ÊûêÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÈÖçÁΩÆ
                    if (!config) {
                        console.warn('ÈÖçÁΩÆÊñá‰ª∂Ëß£ÊûêÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÈÖçÁΩÆ');
                        return this.getDefaultConfig();
                    }
                    
                    return config;
                    
                } catch (error) {
                    console.warn('Êó†Ê≥ïËØªÂèñ postcss.config.jsÔºå‰ΩøÁî®ÈªòËÆ§ÈÖçÁΩÆ:', error.message);
                    return this.getDefaultConfig();
                }
            }
            
            // Ëß£Êûê PostCSS ÈÖçÁΩÆÊñá‰ª∂ÂÜÖÂÆπ
            parsePostCSSConfig(configText) {
                try {
                    let cleanText = configText.trim();
                    
                    // Â§ÑÁêÜ CommonJS Ê†ºÂºè (module.exports = {...})
                    if (cleanText.includes('module.exports')) {
                        cleanText = cleanText
                            .replace(/module\.exports\s*=\s*/, '')
                            .replace(/;\s*$/, '')
                            .trim();
                    }
                    // Â§ÑÁêÜ ES Module Ê†ºÂºè (export default {...})
                    else if (cleanText.includes('export default')) {
                        cleanText = cleanText
                            .replace(/export\s+default\s+/, '')
                            .replace(/;\s*$/, '')
                            .trim();
                    }
                    
                    // Â§ÑÁêÜÂèØËÉΩÁöÑÂä®ÊÄÅÈÖçÁΩÆ
                    if (cleanText.includes('process.env.NODE_ENV')) {
                        // ËÆæÁΩÆÁéØÂ¢ÉÂèòÈáèÈªòËÆ§ÂÄº
                        cleanText = cleanText.replace(/process\.env\.NODE_ENV/g, '"development"');
                    }
                    
                    console.log('Ê∏ÖÁêÜÂêéÁöÑÈÖçÁΩÆÊñáÊú¨:', cleanText);
                    
                    // ‰ΩøÁî® Function ÊûÑÈÄ†Âô®ÂÆâÂÖ®Âú∞ÊâßË°åÈÖçÁΩÆ‰ª£Á†Å
                    const configFunction = new Function('return ' + cleanText);
                    const config = configFunction();
                    
                    console.log('Ëß£ÊûêÂêéÁöÑÈÖçÁΩÆ:', config);
                    return config;
                    
                } catch (error) {
                    console.error('ÈÖçÁΩÆÊñá‰ª∂Ëß£ÊûêÂ§±Ë¥•:', error);
                    return null;
                }
            }
            
            // Ëé∑ÂèñÈªòËÆ§ÈÖçÁΩÆ
            getDefaultConfig() {
                return {
                    plugins: {
                        'postcss-import': {},
                        'tailwindcss': {},
                        'autoprefixer': {},
                        'cssnano': false
                    },
                    options: {
                        from: 'input.css',
                        to: 'output.css',
                        map: false
                    }
                };
            }

            // ÊâßË°å CSS ËΩ¨Êç¢
            async transformCSS(css) {
                if (!this.initialized) {
                    this.showStatus('‚ö†Ô∏è ËØ∑ÂÖàÂàùÂßãÂåñ PostCSS', 'warning');
                    return;
                }

                try {
                    this.updateStatus('‚è≥ Ê≠£Âú®ËΩ¨Êç¢‰∏≠...', 'processing');
                    
                    this.worker.postMessage({
                        type: 'transform',
                        data: css,
                        options: {
                            from: 'input.css',
                            to: 'output.css'
                        }
                    });

                } catch (error) {
                    console.error('ËΩ¨Êç¢Â§±Ë¥•:', error);
                    this.updateStatus(`‚ùå ËΩ¨Êç¢Â§±Ë¥•: ${error.message}`, 'error');
                }
            }

            // ËøêË°åÊµãËØï
            async runTests() {
                if (!this.initialized) {
                    this.showStatus('‚ö†Ô∏è ËØ∑ÂÖàÂàùÂßãÂåñ PostCSS', 'warning');
                    return;
                }

                try {
                    this.updateStatus('‚è≥ Ê≠£Âú®ËøêË°åÊµãËØï...', 'processing');
                    
                    this.worker.postMessage({
                        type: 'test'
                    });

                } catch (error) {
                    console.error('ÊµãËØïÂ§±Ë¥•:', error);
                    this.updateStatus(`‚ùå ÊµãËØïÂ§±Ë¥•: ${error.message}`, 'error');
                }
            }

            // Ê£ÄÊü•Áä∂ÊÄÅ
            async checkStatus() {
                this.worker.postMessage({
                    type: 'getStatus'
                });
            }

            // Êõ¥Êñ∞Áä∂ÊÄÅ
            updateStatus(message, type) {
                const statusDot = document.getElementById('statusDot');
                const statusText = document.getElementById('statusText');
                
                statusText.textContent = message;
                statusDot.className = `status-dot ${type}`;
            }

            // ÊòæÁ§∫Áä∂ÊÄÅÊ∂àÊÅØ
            showStatus(message, type) {
                const statusDiv = document.getElementById('status');
                statusDiv.textContent = message;
                statusDiv.className = `status ${type} show`;
                
                // 3ÁßíÂêéËá™Âä®ÈöêËóè
                setTimeout(() => {
                    statusDiv.classList.remove('show');
                }, 3000);
            }

            // ÂêØÁî®ËΩ¨Êç¢ÊåâÈíÆ
            enableTransformButton() {
                document.getElementById('transformBtn').disabled = false;
            }

            // ÊòæÁ§∫ÈÖçÁΩÆ‰ø°ÊÅØ
            showConfigInfo() {
                const configInfo = document.getElementById('configInfo');
                const configDetails = document.getElementById('configDetails');
                
                configDetails.textContent = JSON.stringify(this.config, null, 2);
                configInfo.style.display = 'block';
            }

            // ÊòæÁ§∫ËΩ¨Êç¢ÁªìÊûú
            showTransformResult(data) {
                const resultOutput = document.getElementById('resultOutput');
                resultOutput.textContent = data.css;
                resultOutput.style.display = 'block';
            }

            // ÊòæÁ§∫ÊµãËØïÁªìÊûú
            showTestResults(data) {
                const testResults = document.getElementById('testResults');
                const testStatus = document.getElementById('testStatus');
                
                let html = `
                    <div class="test-section">
                        <h3>üß™ ÊµãËØïÁªìÊûúÊÄªËßà</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin: 16px 0;">
                            <div style="background: #f0f9ff; padding: 16px; border-radius: 8px; border: 1px solid #0ea5e9;">
                                <h4 style="margin: 0 0 8px 0; color: #0369a1;">üìä ÊÄª‰ΩìÁªüËÆ°</h4>
                                <p style="margin: 0; font-size: 14px;">ÊÄªÊµãËØï: ${data.total} | ÈÄöËøá: ${data.passed} | Â§±Ë¥•: ${data.failed}</p>
                            </div>
                `;
                
                if (data.autoprefixerTests) {
                    html += `
                            <div style="background: #f0fdf4; padding: 16px; border-radius: 8px; border: 1px solid #10b981;">
                                <h4 style="margin: 0 0 8px 0; color: #059669;">üîß Autoprefixer ÊµãËØï</h4>
                                <p style="margin: 0; font-size: 14px;">ÊÄªËÆ°: ${data.autoprefixerTests.total} | ÈÄöËøá: ${data.autoprefixerTests.passed} | Â§±Ë¥•: ${data.autoprefixerTests.failed}</p>
                            </div>
                    `;
                }
                
                if (data.basicTests) {
                    html += `
                            <div style="background: #fefce8; padding: 16px; border-radius: 8px; border: 1px solid #eab308;">
                                <h4 style="margin: 0 0 8px 0; color: #a16207;">‚öôÔ∏è Âü∫Á°ÄÊµãËØï</h4>
                                <p style="margin: 0; font-size: 14px;">ÊÄªËÆ°: ${data.basicTests.total} | ÈÄöËøá: ${data.basicTests.passed} | Â§±Ë¥•: ${data.basicTests.failed}</p>
                            </div>
                    `;
                }
                
                html += `
                        </div>
                        <p style="color: #6b7280; font-size: 14px;">ÊµãËØïÊó∂Èó¥: ${new Date(data.timestamp).toLocaleString()}</p>
                `;
                
                // Autoprefixer ‰∏ìÈ°πÊµãËØïÁªìÊûú
                if (data.autoprefixerTests && data.autoprefixerTests.tests.length > 0) {
                    html += `
                        <h3 style="margin-top: 24px;">üîß Autoprefixer ‰∏ìÈ°πÊµãËØïËØ¶ÊÉÖ</h3>
                    `;
                    
                    data.autoprefixerTests.tests.forEach(test => {
                        const status = test.success ? '‚úÖ' : '‚ùå';
                        const color = test.success ? '#10b981' : '#ef4444';
                        
                        html += `
                            <div style="margin: 16px 0; padding: 16px; border: 1px solid ${color}; border-radius: 6px; background: ${test.success ? '#f0fdf4' : '#fef2f2'};">
                                <h4 style="margin: 0 0 8px 0; color: ${color};">${status} ${test.name}</h4>
                                ${test.success ? 
                                    `<p style="margin: 0 0 8px 0; color: #065f46;">${test.message}</p>
                                     <details style="margin-top: 12px;">
                                         <summary style="cursor: pointer; font-weight: 600; color: #374151;">Êü•ÁúãËØ¶ÁªÜÁªìÊûú</summary>
                                         <div style="margin-top: 12px;">
                                             <div style="margin-bottom: 12px;">
                                                 <strong style="color: #374151;">ËæìÂÖ• CSS:</strong>
                                                 <pre style="background: #f3f4f6; padding: 12px; border-radius: 4px; margin: 8px 0; font-size: 12px; overflow-x: auto; border: 1px solid #d1d5db;">${test.input}</pre>
                                             </div>
                                             <div>
                                                 <strong style="color: #374151;">ËæìÂá∫ CSS:</strong>
                                                 <pre style="background: #f3f4f6; padding: 12px; border-radius: 4px; margin: 8px 0; font-size: 12px; overflow-x: auto; border: 1px solid #d1d5db;">${test.output}</pre>
                                             </div>
                                         </div>
                                     </details>` : 
                                    `<p style="margin: 0; color: #991b1b;"><strong>ÈîôËØØ:</strong> ${test.error}</p>`
                                }
                            </div>
                        `;
                    });
                }
                
                // Âü∫Á°ÄÊµãËØïÁªìÊûú
                if (data.basicTests && data.basicTests.tests.length > 0) {
                    html += `
                        <h3 style="margin-top: 24px;">‚öôÔ∏è Âü∫Á°ÄÂäüËÉΩÊµãËØïËØ¶ÊÉÖ</h3>
                    `;
                    
                    data.basicTests.tests.forEach(test => {
                        const status = test.success ? '‚úÖ' : '‚ùå';
                        const color = test.success ? '#10b981' : '#ef4444';
                        
                        html += `
                            <div style="margin: 16px 0; padding: 16px; border: 1px solid ${color}; border-radius: 6px;">
                                <h4 style="margin: 0 0 8px 0; color: ${color};">${status} ${test.name}</h4>
                                ${test.success ? 
                                    `<p style="margin: 0 0 8px 0; color: #065f46;">${test.message}</p>
                                     <details>
                                         <summary style="cursor: pointer;">Êü•ÁúãËØ¶ÊÉÖ</summary>
                                         <div style="margin-top: 8px;">
                                             <strong>ËæìÂÖ•:</strong>
                                             <pre style="background: #f3f4f6; padding: 8px; border-radius: 4px; margin: 4px 0; font-size: 12px;">${test.input}</pre>
                                             <strong>ËæìÂá∫:</strong>
                                             <pre style="background: #f3f4f6; padding: 8px; border-radius: 4px; margin: 4px 0; font-size: 12px;">${test.output}</pre>
                                         </div>
                                     </details>` : 
                                    `<p style="margin: 0; color: #991b1b;">ÈîôËØØ: ${test.error}</p>`
                                }
                            </div>
                        `;
                    });
                }
                
                html += '</div>';
                testResults.innerHTML = html;
                
                const successRate = ((data.passed / data.total) * 100).toFixed(1);
                let statusMessage = `‚úÖ ÊµãËØïÂÆåÊàê - ${data.passed}/${data.total} ÈÄöËøá (${successRate}%)`;
                
                if (data.autoprefixerTests) {
                    const apSuccessRate = ((data.autoprefixerTests.passed / data.autoprefixerTests.total) * 100).toFixed(1);
                    statusMessage += ` | Autoprefixer: ${data.autoprefixerTests.passed}/${data.autoprefixerTests.total} (${apSuccessRate}%)`;
                }
                
                testStatus.textContent = statusMessage;
                testStatus.className = 'status success show';
            }

            // ÊòæÁ§∫ Worker Áä∂ÊÄÅ
            showWorkerStatus(data) {
                console.log('Worker Áä∂ÊÄÅ:', data);
                let message = `Worker Áä∂ÊÄÅ: ${data.initialized ? 'Â∑≤ÂàùÂßãÂåñ' : 'Êú™ÂàùÂßãÂåñ'}`;
                if (data.postcssAvailable) {
                    message += ' | PostCSS ÂèØÁî®';
                }
                this.showStatus(message, data.initialized ? 'success' : 'warning');
            }
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            const postcssManager = new PostCSSManager();
            
            // ÁªëÂÆöÊåâÈíÆ‰∫ã‰ª∂
            document.getElementById('initBtn').addEventListener('click', () => {
                postcssManager.initPostCSS();
            });
            
            document.getElementById('transformBtn').addEventListener('click', () => {
                const cssInput = document.getElementById('cssInput').value.trim();
                if (cssInput) {
                    postcssManager.transformCSS(cssInput);
                } else {
                    postcssManager.showStatus('‚ö†Ô∏è ËØ∑ËæìÂÖ•Ë¶ÅËΩ¨Êç¢ÁöÑ CSS ‰ª£Á†Å', 'warning');
                }
            });
            
            document.getElementById('testBtn').addEventListener('click', () => {
                postcssManager.runTests();
            });
            
            document.getElementById('statusBtn').addEventListener('click', () => {
                postcssManager.checkStatus();
            });
            
            document.getElementById('clearBtn').addEventListener('click', () => {
                document.getElementById('cssInput').value = '';
                document.getElementById('resultOutput').style.display = 'none';
                document.getElementById('status').classList.remove('show');
            });
            
            document.getElementById('clearTestsBtn').addEventListener('click', () => {
                document.getElementById('testResults').innerHTML = '';
                document.getElementById('testStatus').classList.remove('show');
            });
            
            // Ê†áÁ≠æÈ°µÂàáÊç¢
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.dataset.tab;
                    
                    // Êõ¥Êñ∞Ê†áÁ≠æÈ°µÁä∂ÊÄÅ
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Êõ¥Êñ∞ÂÜÖÂÆπÊòæÁ§∫
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(targetTab).classList.add('active');
                });
            });
            
            // Ëá™Âä®ÂàùÂßãÂåñ
            setTimeout(() => {
                postcssManager.initPostCSS();
            }, 1000);
        });

        // Âä†ËΩΩÁ§∫‰æã‰ª£Á†Å
        window.loadExample = function(type) {
            const examples = {
                tailwind: `/* Tailwind CSS ÁªÑ‰ª∂Á§∫‰æã */
@layer components {
  .btn-primary {
    @apply bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded transition-colors;
  }
  
  .card {
    @apply bg-white rounded-lg shadow-md p-6 border border-gray-200;
  }
  
  .input-field {
    @apply w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500;
  }
}`,

                variables: `/* CSS ÂèòÈáèÁ§∫‰æã */
:root {
  --primary-color: #3b82f6;
  --secondary-color: #6b7280;
  --success-color: #10b981;
  --danger-color: #ef4444;
}

.button {
  background-color: var(--primary-color);
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 0.25rem;
  transition: background-color 0.2s;
}

.button:hover {
  background-color: var(--secondary-color);
}

.alert {
  padding: 1rem;
  border-radius: 0.25rem;
  margin: 1rem 0;
}

.alert-success {
  background-color: var(--success-color);
  color: white;
}

.alert-danger {
  background-color: var(--danger-color);
  color: white;
}`,

                nested: `/* ÂµåÂ•ó CSS Á§∫‰æã */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1rem;
  
  .header {
    background: #f8f9fa;
    padding: 1rem;
    border-bottom: 1px solid #e9ecef;
    
    h1 {
      color: #333;
      margin: 0;
      font-size: 2rem;
    }
    
    nav {
      margin-top: 1rem;
      
      ul {
        list-style: none;
        display: flex;
        gap: 1rem;
        margin: 0;
        padding: 0;
        
        li {
          a {
            color: #666;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
            
            &:hover {
              color: #333;
              background: #e9ecef;
            }
          }
        }
      }
    }
  }
  
  .main {
    padding: 2rem 0;
    
    .content {
      background: white;
      padding: 2rem;
      border-radius: 0.5rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
  }
}`,

                media: `/* ÂìçÂ∫îÂºèÂ™í‰ΩìÊü•ËØ¢Á§∫‰æã */
.container {
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1rem;
}

.grid {
  display: grid;
  gap: 1rem;
  grid-template-columns: 1fr;
}

.card {
  background: white;
  padding: 1rem;
  border-radius: 0.5rem;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* Â∞èÂ±èÂπï */
@media (min-width: 640px) {
  .grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .card {
    padding: 1.5rem;
  }
}

/* ‰∏≠Á≠âÂ±èÂπï */
@media (min-width: 768px) {
  .container {
    padding: 0 2rem;
  }
  
  .grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
  }
}

/* Â§ßÂ±èÂπï */
@media (min-width: 1024px) {
  .grid {
    grid-template-columns: repeat(4, 1fr);
    gap: 2rem;
  }
  
  .card {
    padding: 2rem;
  }
}

/* Ë∂ÖÂ§ßÂ±èÂπï */
@media (min-width: 1280px) {
  .container {
    max-width: 1400px;
  }
}`
            };
            
            if (examples[type]) {
                document.getElementById('cssInput').value = examples[type];
                // ÂàáÊç¢Âà∞ËΩ¨Êç¢Ê†áÁ≠æÈ°µ
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelector('[data-tab="transform"]').classList.add('active');
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById('transform').classList.add('active');
            }
        };
    </script>
</body>

</html>