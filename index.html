<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PostCSS Worker æµ‹è¯• - ä¸»çº¿ç¨‹é…ç½®ï¼ŒWorker æ‰§è¡Œ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f3f4f6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 24px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2rem;
        }

        .header p {
            margin: 8px 0 0 0;
            opacity: 0.9;
        }

        .content {
            padding: 24px;
        }

        .status-bar {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ef4444;
        }

        .status-dot.ready {
            background: #10b981;
        }

        .status-dot.processing {
            background: #f59e0b;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .test-section {
            margin-bottom: 24px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
        }

        .test-section h3 {
            margin: 0 0 16px 0;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .input-group textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            resize: vertical;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #2563eb;
        }

        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #4b5563;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #059669;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover:not(:disabled) {
            background: #d97706;
        }

        .status {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-weight: 500;
            display: none;
        }

        .status.show {
            display: block;
        }

        .status.processing {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .status.warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fcd34d;
        }

        .result-section {
            background: #1f2937;
            color: #f9fafb;
            padding: 16px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .quick-tests {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .quick-test {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 16px;
            text-align: center;
        }

        .quick-test h4 {
            margin: 0 0 12px 0;
            color: #374151;
            font-size: 1rem;
        }

        .quick-test-btn {
            background: #10b981;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .quick-test-btn:hover {
            background: #059669;
        }

        .config-info {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .config-info h4 {
            margin: 0 0 12px 0;
            color: #0369a1;
        }

        .config-details {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            background: #e0f2fe;
            padding: 12px;
            border-radius: 4px;
            overflow-x: auto;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            border: none;
            background: none;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            color: #6b7280;
            font-weight: 500;
        }

        .tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ PostCSS Worker æµ‹è¯•</h1>
            <p>ä¸»çº¿ç¨‹é…ç½®ï¼ŒWorker æ‰§è¡Œ - å®Œå…¨åœ¨ Web Worker ä¸­è¿è¡Œ PostCSS è½¬æ¢</p>
        </div>

        <div class="content">
            <!-- çŠ¶æ€æ  -->
            <div class="status-bar">
                <div class="status-indicator">
                    <div id="statusDot" class="status-dot"></div>
                    <span id="statusText">åˆå§‹åŒ–ä¸­...</span>
                </div>
                <div>
                    <button id="initBtn" class="btn btn-primary">åˆå§‹åŒ– PostCSS</button>
                    <button id="testBtn" class="btn btn-secondary">è¿è¡Œæµ‹è¯•</button>
                    <button id="statusBtn" class="btn btn-warning">æ£€æŸ¥çŠ¶æ€</button>
                </div>
            </div>

            <!-- é…ç½®ä¿¡æ¯ -->
            <div id="configInfo" class="config-info" style="display: none;">
                <h4>ğŸ“‹ PostCSS é…ç½®ä¿¡æ¯</h4>
                <div id="configDetails" class="config-details"></div>
            </div>

            <!-- æ ‡ç­¾é¡µ -->
            <div class="tabs">
                <button class="tab active" data-tab="transform">CSS è½¬æ¢</button>
                <button class="tab" data-tab="test">æµ‹è¯•ç”¨ä¾‹</button>
                <button class="tab" data-tab="examples">ç¤ºä¾‹ä»£ç </button>
            </div>

            <!-- CSS è½¬æ¢æ ‡ç­¾é¡µ -->
            <div id="transform" class="tab-content active">
                <div class="test-section">
                    <h3>ğŸ¨ CSS è½¬æ¢æµ‹è¯•</h3>

                    <div class="input-group">
                        <label for="cssInput">è¾“å…¥ CSS ä»£ç ï¼š</label>
                        <textarea id="cssInput" placeholder="è¾“å…¥è¦è½¬æ¢çš„ CSS ä»£ç ...">/* æµ‹è¯• CSS */
.container {
  max-width: 1200px;
  margin: 0 auto;
}

.btn {
  @apply bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600;
}

.card {
  @apply bg-white rounded-lg shadow-md p-6 border border-gray-200;
}</textarea>
                    </div>

                    <div class="button-group">
                        <button id="transformBtn" class="btn btn-primary" disabled>è½¬æ¢ CSS</button>
                        <button id="clearBtn" class="btn btn-secondary">æ¸…ç©º</button>
                    </div>

                    <div id="status" class="status"></div>

                    <div class="input-group">
                        <label for="resultOutput">è½¬æ¢ç»“æœï¼š</label>
                        <div id="resultOutput" class="result-section" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- æµ‹è¯•ç”¨ä¾‹æ ‡ç­¾é¡µ -->
            <div id="test" class="tab-content">
                <div class="test-section">
                    <h3>ğŸ§ª PostCSS åŠŸèƒ½æµ‹è¯•</h3>
                    <p>æµ‹è¯• PostCSS åœ¨ Worker ä¸­çš„å„ç§åŠŸèƒ½</p>
                    
                    <div class="button-group">
                        <button id="runTestsBtn" class="btn btn-success">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
                        <button id="clearTestsBtn" class="btn btn-secondary">æ¸…ç©ºç»“æœ</button>
                    </div>

                    <div id="testStatus" class="status"></div>
                    <div id="testResults"></div>
                </div>
            </div>

            <!-- ç¤ºä¾‹ä»£ç æ ‡ç­¾é¡µ -->
            <div id="examples" class="tab-content">
                <div class="test-section">
                    <h3>ğŸ“š å¿«é€Ÿæµ‹è¯•ç”¨ä¾‹</h3>
                    <div class="quick-tests">
                        <div class="quick-test">
                            <h4>Tailwind ç»„ä»¶</h4>
                            <button class="quick-test-btn" onclick="loadExample('tailwind')">åŠ è½½</button>
                        </div>

                        <div class="quick-test">
                            <h4>CSS å˜é‡</h4>
                            <button class="quick-test-btn" onclick="loadExample('variables')">åŠ è½½</button>
                        </div>

                        <div class="quick-test">
                            <h4>åµŒå¥— CSS</h4>
                            <button class="quick-test-btn" onclick="loadExample('nested')">åŠ è½½</button>
                        </div>

                        <div class="quick-test">
                            <h4>åª’ä½“æŸ¥è¯¢</h4>
                            <button class="quick-test-btn" onclick="loadExample('media')">åŠ è½½</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // PostCSS é…ç½®ç®¡ç†ç±»
        class PostCSSManager {
            constructor() {
                this.worker = null;
                this.config = null;
                this.processor = null;
                this.initialized = false;
                this.initWorker();
            }

            // åˆå§‹åŒ– Worker
            initWorker() {
                try {
                    this.worker = new Worker('./worker.js');
                    this.worker.onmessage = this.handleWorkerMessage.bind(this);
                    this.worker.onerror = this.handleWorkerError.bind(this);
                    console.log('Worker å·²åˆ›å»º');
                } catch (error) {
                    console.error('Worker åˆ›å»ºå¤±è´¥:', error);
                    this.showStatus('âŒ Worker åˆ›å»ºå¤±è´¥', 'error');
                }
            }

            // å¤„ç† Worker æ¶ˆæ¯
            handleWorkerMessage(e) {
                const { type, data, error } = e.data;
                
                switch (type) {
                    case 'init_success':
                        this.initialized = true;
                        this.updateStatus('âœ… PostCSS åˆå§‹åŒ–æˆåŠŸ', 'ready');
                        this.enableTransformButton();
                        this.showConfigInfo();
                        break;
                        
                    case 'init_error':
                        this.initialized = false;
                        this.updateStatus(`âŒ åˆå§‹åŒ–å¤±è´¥: ${error}`, 'error');
                        break;
                        
                    case 'transform_success':
                        this.showTransformResult(data);
                        this.updateStatus('âœ… CSS è½¬æ¢æˆåŠŸ', 'ready');
                        break;
                        
                    case 'transform_error':
                        this.updateStatus(`âŒ è½¬æ¢å¤±è´¥: ${error}`, 'error');
                        break;
                        
                    case 'test_success':
                        this.showTestResults(data);
                        this.updateStatus('âœ… æµ‹è¯•å®Œæˆ', 'ready');
                        break;
                        
                    case 'test_error':
                        this.updateStatus(`âŒ æµ‹è¯•å¤±è´¥: ${error}`, 'error');
                        break;
                        
                    case 'status':
                        this.showWorkerStatus(data);
                        break;
                        
                    default:
                        console.log('æœªçŸ¥æ¶ˆæ¯ç±»å‹:', type, e.data);
                }
            }

            // å¤„ç† Worker é”™è¯¯
            handleWorkerError(error) {
                console.error('Worker é”™è¯¯:', error);
                this.updateStatus(`âŒ Worker é”™è¯¯: ${error.message}`, 'error');
            }

            // åˆå§‹åŒ– PostCSS
            async initPostCSS() {
                try {
                    this.updateStatus('â³ æ­£åœ¨åˆå§‹åŒ– PostCSS...', 'processing');
                    
                    // è¯»å– postcss.config.js é…ç½®æ–‡ä»¶
                    this.config = await this.loadPostCSSConfig();
                    
                    console.log('å·²è¯»å– PostCSS é…ç½®:', this.config);

                    // å‘é€é…ç½®ç»™ Workerï¼ˆä¸åŒ…å«å¤„ç†å™¨ï¼‰
                    this.worker.postMessage({
                        type: 'init',
                        data: {
                            config: this.config
                        }
                    });

                } catch (error) {
                    console.error('PostCSS åˆå§‹åŒ–å¤±è´¥:', error);
                    this.updateStatus(`âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                }
            }

            // åŠ è½½ PostCSS é…ç½®æ–‡ä»¶
            async loadPostCSSConfig() {
                try {
                    // è·å– postcss.config.js æ–‡ä»¶å†…å®¹
                    const response = await fetch('./postcss.config.js');
                    if (!response.ok) {
                        throw new Error(`æ— æ³•åŠ è½½é…ç½®æ–‡ä»¶: ${response.status} ${response.statusText}`);
                    }
                    
                    const configText = await response.text();                    
                    // è§£æé…ç½®æ–‡ä»¶
                    // ç”±äºé…ç½®æ–‡ä»¶æ˜¯ ES module æ ¼å¼ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹æ®Šå¤„ç†
                    const config = this.parsePostCSSConfig(configText);
                    
                    // å¦‚æœè§£æå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®
                    if (!config) {
                        console.warn('é…ç½®æ–‡ä»¶è§£æå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®');
                        return this.getDefaultConfig();
                    }
                    
                    return config;
                    
                } catch (error) {
                    console.warn('æ— æ³•è¯»å– postcss.config.jsï¼Œä½¿ç”¨é»˜è®¤é…ç½®:', error.message);
                    return this.getDefaultConfig();
                }
            }
            
            // è§£æ PostCSS é…ç½®æ–‡ä»¶å†…å®¹
            parsePostCSSConfig(configText) {
                try {
                    let cleanText = configText.trim();
                    
                    // å¤„ç† CommonJS æ ¼å¼ (module.exports = {...})
                    if (cleanText.includes('module.exports')) {
                        cleanText = cleanText
                            .replace(/module\.exports\s*=\s*/, '')
                            .replace(/;\s*$/, '')
                            .trim();
                    }
                    // å¤„ç† ES Module æ ¼å¼ (export default {...})
                    else if (cleanText.includes('export default')) {
                        cleanText = cleanText
                            .replace(/export\s+default\s+/, '')
                            .replace(/;\s*$/, '')
                            .trim();
                    }
                    
                    // å¤„ç†å¯èƒ½çš„åŠ¨æ€é…ç½®
                    if (cleanText.includes('process.env.NODE_ENV')) {
                        // è®¾ç½®ç¯å¢ƒå˜é‡é»˜è®¤å€¼
                        cleanText = cleanText.replace(/process\.env\.NODE_ENV/g, '"development"');
                    }
                    
                    console.log('æ¸…ç†åçš„é…ç½®æ–‡æœ¬:', cleanText);
                    
                    // ä½¿ç”¨ Function æ„é€ å™¨å®‰å…¨åœ°æ‰§è¡Œé…ç½®ä»£ç 
                    const configFunction = new Function('return ' + cleanText);
                    const config = configFunction();
                    
                    console.log('è§£æåçš„é…ç½®:', config);
                    return config;
                    
                } catch (error) {
                    console.error('é…ç½®æ–‡ä»¶è§£æå¤±è´¥:', error);
                    return null;
                }
            }
            
            // è·å–é»˜è®¤é…ç½®
            getDefaultConfig() {
                return {
                    plugins: {
                        'postcss-import': {},
                        'tailwindcss': {},
                        'autoprefixer': {},
                        'cssnano': false
                    },
                    options: {
                        from: 'input.css',
                        to: 'output.css',
                        map: false
                    }
                };
            }

            // æ‰§è¡Œ CSS è½¬æ¢
            async transformCSS(css) {
                if (!this.initialized) {
                    this.showStatus('âš ï¸ è¯·å…ˆåˆå§‹åŒ– PostCSS', 'warning');
                    return;
                }

                try {
                    this.updateStatus('â³ æ­£åœ¨è½¬æ¢ä¸­...', 'processing');
                    
                    this.worker.postMessage({
                        type: 'transform',
                        data: css,
                        options: {
                            from: 'input.css',
                            to: 'output.css'
                        }
                    });

                } catch (error) {
                    console.error('è½¬æ¢å¤±è´¥:', error);
                    this.updateStatus(`âŒ è½¬æ¢å¤±è´¥: ${error.message}`, 'error');
                }
            }

            // è¿è¡Œæµ‹è¯•
            async runTests() {
                if (!this.initialized) {
                    this.showStatus('âš ï¸ è¯·å…ˆåˆå§‹åŒ– PostCSS', 'warning');
                    return;
                }

                try {
                    this.updateStatus('â³ æ­£åœ¨è¿è¡Œæµ‹è¯•...', 'processing');
                    
                    this.worker.postMessage({
                        type: 'test'
                    });

                } catch (error) {
                    console.error('æµ‹è¯•å¤±è´¥:', error);
                    this.updateStatus(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }

            // æ£€æŸ¥çŠ¶æ€
            async checkStatus() {
                this.worker.postMessage({
                    type: 'getStatus'
                });
            }

            // æ›´æ–°çŠ¶æ€
            updateStatus(message, type) {
                const statusDot = document.getElementById('statusDot');
                const statusText = document.getElementById('statusText');
                
                statusText.textContent = message;
                statusDot.className = `status-dot ${type}`;
            }

            // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
            showStatus(message, type) {
                const statusDiv = document.getElementById('status');
                statusDiv.textContent = message;
                statusDiv.className = `status ${type} show`;
                
                // 3ç§’åè‡ªåŠ¨éšè—
                setTimeout(() => {
                    statusDiv.classList.remove('show');
                }, 3000);
            }

            // å¯ç”¨è½¬æ¢æŒ‰é’®
            enableTransformButton() {
                document.getElementById('transformBtn').disabled = false;
            }

            // æ˜¾ç¤ºé…ç½®ä¿¡æ¯
            showConfigInfo() {
                const configInfo = document.getElementById('configInfo');
                const configDetails = document.getElementById('configDetails');
                
                configDetails.textContent = JSON.stringify(this.config, null, 2);
                configInfo.style.display = 'block';
            }

            // æ˜¾ç¤ºè½¬æ¢ç»“æœ
            showTransformResult(data) {
                const resultOutput = document.getElementById('resultOutput');
                resultOutput.textContent = data.css;
                resultOutput.style.display = 'block';
            }

            // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
            showTestResults(data) {
                const testResults = document.getElementById('testResults');
                const testStatus = document.getElementById('testStatus');
                
                let html = `
                    <div class="test-section">
                        <h3>ğŸ§ª æµ‹è¯•ç»“æœæ€»è§ˆ</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin: 16px 0;">
                            <div style="background: #f0f9ff; padding: 16px; border-radius: 8px; border: 1px solid #0ea5e9;">
                                <h4 style="margin: 0 0 8px 0; color: #0369a1;">ğŸ“Š æ€»ä½“ç»Ÿè®¡</h4>
                                <p style="margin: 0; font-size: 14px;">æ€»æµ‹è¯•: ${data.total} | é€šè¿‡: ${data.passed} | å¤±è´¥: ${data.failed}</p>
                            </div>
                `;
                
                if (data.autoprefixerTests) {
                    html += `
                            <div style="background: #f0fdf4; padding: 16px; border-radius: 8px; border: 1px solid #10b981;">
                                <h4 style="margin: 0 0 8px 0; color: #059669;">ğŸ”§ Autoprefixer æµ‹è¯•</h4>
                                <p style="margin: 0; font-size: 14px;">æ€»è®¡: ${data.autoprefixerTests.total} | é€šè¿‡: ${data.autoprefixerTests.passed} | å¤±è´¥: ${data.autoprefixerTests.failed}</p>
                            </div>
                    `;
                }
                
                if (data.basicTests) {
                    html += `
                            <div style="background: #fefce8; padding: 16px; border-radius: 8px; border: 1px solid #eab308;">
                                <h4 style="margin: 0 0 8px 0; color: #a16207;">âš™ï¸ åŸºç¡€æµ‹è¯•</h4>
                                <p style="margin: 0; font-size: 14px;">æ€»è®¡: ${data.basicTests.total} | é€šè¿‡: ${data.basicTests.passed} | å¤±è´¥: ${data.basicTests.failed}</p>
                            </div>
                    `;
                }
                
                html += `
                        </div>
                        <p style="color: #6b7280; font-size: 14px;">æµ‹è¯•æ—¶é—´: ${new Date(data.timestamp).toLocaleString()}</p>
                `;
                
                // Autoprefixer ä¸“é¡¹æµ‹è¯•ç»“æœ
                if (data.autoprefixerTests && data.autoprefixerTests.tests.length > 0) {
                    html += `
                        <h3 style="margin-top: 24px;">ğŸ”§ Autoprefixer ä¸“é¡¹æµ‹è¯•è¯¦æƒ…</h3>
                    `;
                    
                    data.autoprefixerTests.tests.forEach(test => {
                        const status = test.success ? 'âœ…' : 'âŒ';
                        const color = test.success ? '#10b981' : '#ef4444';
                        
                        html += `
                            <div style="margin: 16px 0; padding: 16px; border: 1px solid ${color}; border-radius: 6px; background: ${test.success ? '#f0fdf4' : '#fef2f2'};">
                                <h4 style="margin: 0 0 8px 0; color: ${color};">${status} ${test.name}</h4>
                                ${test.success ? 
                                    `<p style="margin: 0 0 8px 0; color: #065f46;">${test.message}</p>
                                     <details style="margin-top: 12px;">
                                         <summary style="cursor: pointer; font-weight: 600; color: #374151;">æŸ¥çœ‹è¯¦ç»†ç»“æœ</summary>
                                         <div style="margin-top: 12px;">
                                             <div style="margin-bottom: 12px;">
                                                 <strong style="color: #374151;">è¾“å…¥ CSS:</strong>
                                                 <pre style="background: #f3f4f6; padding: 12px; border-radius: 4px; margin: 8px 0; font-size: 12px; overflow-x: auto; border: 1px solid #d1d5db;">${test.input}</pre>
                                             </div>
                                             <div>
                                                 <strong style="color: #374151;">è¾“å‡º CSS:</strong>
                                                 <pre style="background: #f3f4f6; padding: 12px; border-radius: 4px; margin: 8px 0; font-size: 12px; overflow-x: auto; border: 1px solid #d1d5db;">${test.output}</pre>
                                             </div>
                                         </div>
                                     </details>` : 
                                    `<p style="margin: 0; color: #991b1b;"><strong>é”™è¯¯:</strong> ${test.error}</p>`
                                }
                            </div>
                        `;
                    });
                }
                
                // åŸºç¡€æµ‹è¯•ç»“æœ
                if (data.basicTests && data.basicTests.tests.length > 0) {
                    html += `
                        <h3 style="margin-top: 24px;">âš™ï¸ åŸºç¡€åŠŸèƒ½æµ‹è¯•è¯¦æƒ…</h3>
                    `;
                    
                    data.basicTests.tests.forEach(test => {
                        const status = test.success ? 'âœ…' : 'âŒ';
                        const color = test.success ? '#10b981' : '#ef4444';
                        
                        html += `
                            <div style="margin: 16px 0; padding: 16px; border: 1px solid ${color}; border-radius: 6px;">
                                <h4 style="margin: 0 0 8px 0; color: ${color};">${status} ${test.name}</h4>
                                ${test.success ? 
                                    `<p style="margin: 0 0 8px 0; color: #065f46;">${test.message}</p>
                                     <details>
                                         <summary style="cursor: pointer;">æŸ¥çœ‹è¯¦æƒ…</summary>
                                         <div style="margin-top: 8px;">
                                             <strong>è¾“å…¥:</strong>
                                             <pre style="background: #f3f4f6; padding: 8px; border-radius: 4px; margin: 4px 0; font-size: 12px;">${test.input}</pre>
                                             <strong>è¾“å‡º:</strong>
                                             <pre style="background: #f3f4f6; padding: 8px; border-radius: 4px; margin: 4px 0; font-size: 12px;">${test.output}</pre>
                                         </div>
                                     </details>` : 
                                    `<p style="margin: 0; color: #991b1b;">é”™è¯¯: ${test.error}</p>`
                                }
                            </div>
                        `;
                    });
                }
                
                html += '</div>';
                testResults.innerHTML = html;
                
                const successRate = ((data.passed / data.total) * 100).toFixed(1);
                let statusMessage = `âœ… æµ‹è¯•å®Œæˆ - ${data.passed}/${data.total} é€šè¿‡ (${successRate}%)`;
                
                if (data.autoprefixerTests) {
                    const apSuccessRate = ((data.autoprefixerTests.passed / data.autoprefixerTests.total) * 100).toFixed(1);
                    statusMessage += ` | Autoprefixer: ${data.autoprefixerTests.passed}/${data.autoprefixerTests.total} (${apSuccessRate}%)`;
                }
                
                testStatus.textContent = statusMessage;
                testStatus.className = 'status success show';
            }

            // æ˜¾ç¤º Worker çŠ¶æ€
            showWorkerStatus(data) {
                console.log('Worker çŠ¶æ€:', data);
                let message = `Worker çŠ¶æ€: ${data.initialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'}`;
                if (data.postcssAvailable) {
                    message += ' | PostCSS å¯ç”¨';
                }
                this.showStatus(message, data.initialized ? 'success' : 'warning');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            const postcssManager = new PostCSSManager();
            
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.getElementById('initBtn').addEventListener('click', () => {
                postcssManager.initPostCSS();
            });
            
            document.getElementById('transformBtn').addEventListener('click', () => {
                const cssInput = document.getElementById('cssInput').value.trim();
                if (cssInput) {
                    postcssManager.transformCSS(cssInput);
                } else {
                    postcssManager.showStatus('âš ï¸ è¯·è¾“å…¥è¦è½¬æ¢çš„ CSS ä»£ç ', 'warning');
                }
            });
            
            document.getElementById('testBtn').addEventListener('click', () => {
                postcssManager.runTests();
            });
            
            document.getElementById('statusBtn').addEventListener('click', () => {
                postcssManager.checkStatus();
            });
            
            document.getElementById('clearBtn').addEventListener('click', () => {
                document.getElementById('cssInput').value = '';
                document.getElementById('resultOutput').style.display = 'none';
                document.getElementById('status').classList.remove('show');
            });
            
            document.getElementById('clearTestsBtn').addEventListener('click', () => {
                document.getElementById('testResults').innerHTML = '';
                document.getElementById('testStatus').classList.remove('show');
            });
            
            // æ ‡ç­¾é¡µåˆ‡æ¢
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.dataset.tab;
                    
                    // æ›´æ–°æ ‡ç­¾é¡µçŠ¶æ€
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // æ›´æ–°å†…å®¹æ˜¾ç¤º
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(targetTab).classList.add('active');
                });
            });
            
            // è‡ªåŠ¨åˆå§‹åŒ–
            setTimeout(() => {
                postcssManager.initPostCSS();
            }, 1000);
        });

        // åŠ è½½ç¤ºä¾‹ä»£ç 
        window.loadExample = function(type) {
            const examples = {
                tailwind: `/* Tailwind CSS ç»„ä»¶ç¤ºä¾‹ */
@layer components {
  .btn-primary {
    @apply bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded transition-colors;
  }
  
  .card {
    @apply bg-white rounded-lg shadow-md p-6 border border-gray-200;
  }
  
  .input-field {
    @apply w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500;
  }
}`,

                variables: `/* CSS å˜é‡ç¤ºä¾‹ */
:root {
  --primary-color: #3b82f6;
  --secondary-color: #6b7280;
  --success-color: #10b981;
  --danger-color: #ef4444;
}

.button {
  background-color: var(--primary-color);
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 0.25rem;
  transition: background-color 0.2s;
}

.button:hover {
  background-color: var(--secondary-color);
}

.alert {
  padding: 1rem;
  border-radius: 0.25rem;
  margin: 1rem 0;
}

.alert-success {
  background-color: var(--success-color);
  color: white;
}

.alert-danger {
  background-color: var(--danger-color);
  color: white;
}`,

                nested: `/* åµŒå¥— CSS ç¤ºä¾‹ */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1rem;
  
  .header {
    background: #f8f9fa;
    padding: 1rem;
    border-bottom: 1px solid #e9ecef;
    
    h1 {
      color: #333;
      margin: 0;
      font-size: 2rem;
    }
    
    nav {
      margin-top: 1rem;
      
      ul {
        list-style: none;
        display: flex;
        gap: 1rem;
        margin: 0;
        padding: 0;
        
        li {
          a {
            color: #666;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
            
            &:hover {
              color: #333;
              background: #e9ecef;
            }
          }
        }
      }
    }
  }
  
  .main {
    padding: 2rem 0;
    
    .content {
      background: white;
      padding: 2rem;
      border-radius: 0.5rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
  }
}`,

                media: `/* å“åº”å¼åª’ä½“æŸ¥è¯¢ç¤ºä¾‹ */
.container {
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 1rem;
}

.grid {
  display: grid;
  gap: 1rem;
  grid-template-columns: 1fr;
}

.card {
  background: white;
  padding: 1rem;
  border-radius: 0.5rem;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* å°å±å¹• */
@media (min-width: 640px) {
  .grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .card {
    padding: 1.5rem;
  }
}

/* ä¸­ç­‰å±å¹• */
@media (min-width: 768px) {
  .container {
    padding: 0 2rem;
  }
  
  .grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
  }
}

/* å¤§å±å¹• */
@media (min-width: 1024px) {
  .grid {
    grid-template-columns: repeat(4, 1fr);
    gap: 2rem;
  }
  
  .card {
    padding: 2rem;
  }
}

/* è¶…å¤§å±å¹• */
@media (min-width: 1280px) {
  .container {
    max-width: 1400px;
  }
}`
            };
            
            if (examples[type]) {
                document.getElementById('cssInput').value = examples[type];
                // åˆ‡æ¢åˆ°è½¬æ¢æ ‡ç­¾é¡µ
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelector('[data-tab="transform"]').classList.add('active');
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById('transform').classList.add('active');
            }
        };
    </script>
</body>

</html>